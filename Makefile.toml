# School Payment Advisor - Task Runner
# ä½¿ã„æ–¹: makers <task-name>

[config]
skip_core_tasks = true

[env]
PROJECT_ROOT = "${CARGO_MAKE_WORKING_DIRECTORY}"

[tasks.default]
description = "åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’è¡¨ç¤º"
script = '''
echo "ğŸ“š å¿—æœ›æ ¡æ”¯æ‰•ã„ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ - ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼"
echo ""
echo "åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯:"
echo "  makers dev        - å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•"
echo "  makers build      - å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰"
echo "  makers install    - å…¨ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
echo "  makers clean      - ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’å‰Šé™¤"
'''

# ============ é–‹ç™º ============

[tasks.dev]
description = "å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¸¦åˆ—èµ·å‹•ï¼ˆFrontend + APIï¼‰"
run_task = { name = ["dev-api", "dev-front"], parallel = true }

[tasks.dev-front]
description = "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•"
script = "cd ${PROJECT_ROOT}/frontend && npm run dev"

[tasks.dev-api]
description = "APIã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•"
script = "cd ${PROJECT_ROOT}/api-server && npm run dev"

# ============ ãƒ“ãƒ«ãƒ‰ ============

[tasks.build]
description = "å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰"
dependencies = ["build-lean", "build-api", "build-front"]

[tasks.build-lean]
description = "Leanãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰"
script = "cd ${PROJECT_ROOT}/lean-backend && lake build"

[tasks.build-front]
description = "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰"
script = "cd ${PROJECT_ROOT}/frontend && npm run build"

[tasks.build-api]
description = "APIã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ“ãƒ«ãƒ‰"
script = "cd ${PROJECT_ROOT}/api-server && npm run build"

# ============ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ============

[tasks.install]
description = "å…¨ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
script = '''
cd ${PROJECT_ROOT}/lean-backend && lake update
cd ${PROJECT_ROOT}/frontend && npm install
cd ${PROJECT_ROOT}/api-server && npm install
'''

# ============ ã‚¯ãƒªãƒ¼ãƒ³ ============

[tasks.clean]
description = "ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’å‰Šé™¤"
script = '''
rm -rf ${PROJECT_ROOT}/lean-backend/.lake
rm -rf ${PROJECT_ROOT}/frontend/dist
rm -rf ${PROJECT_ROOT}/api-server/dist
'''
